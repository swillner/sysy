#!/usr/bin/env bash
set -e

ask_to_install_if_not_found cargo && (curl https://sh.rustup.rs -sSf | sh)

command=$1
shift || return 0
case "$command" in

    desc)
        echo
        ;;

    install|sync)
        packages=$(printf '%s\n' "$@" | sort | uniq)
        already_installed=$(cargo install --list \
                                | sed -n 's/^\(.*\) .*:$/\1/p' \
                                | sort)
        readarray -t missing < <(comm -23 <(echo "$packages") <(echo "$already_installed"))
        export TMPDIR=$XDG_RUNTIME_DIR
        [[ "${#missing[@]}" == 0 ]] || cargo install "${missing[@]}"
        ;;

    uninstall)
        cargo uninstall "$@"
        ;;

    *)
        error "Module does not support this command"
        ;;

esac
